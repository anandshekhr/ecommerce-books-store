{% extends "base.html" %}
{% load static %}
{% block title %}{{ product.name|truncatechars:10 }}{% endblock title %}

{% block head %}
<meta name="description" content="{{ product.description|truncatechars:150 }}">
<meta property="og:title" content="{{ product.name }}">
<meta property="og:description" content="{{ product.description|truncatechars:150 }}">
<meta property="og:image" content="{{ product.image.url }}">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:type" content="product">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ product.name }}">
<meta name="twitter:description" content="{{ product.description|truncatechars:150 }}">
<meta name="twitter:image" content="{{ product.image.url }}">
<meta name="keywords" content="{{ product.name }}, VAMS Store, Product">
<meta name="author" content="VAMS Store">
<link rel="canonical" href="{{ request.build_absolute_uri }}">
<link href="{% static " assets/css/base.css" %}" rel="stylesheet">
<link href="{% static " assets/css/item.css" %}" rel="stylesheet">
<style>
  :root {
    --vams-light: #e9e3df;
    /* light grey */
    --vams-accent: #ff7a32;
    /* orange */
    --vams-dark: #43567f;
    /* dark blue */
    --vams-black: #000000;
  }

  /* Title / subtitle */
  .product-title h3 {
    font-weight: 600;
    margin-bottom: .25rem;
  }

  .product-subline {
    color: var(--vams-dark);
    font-size: 0.95rem;
  }

  .product-author {
    color: var(--vams-black);
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }

  /* Price + button */
  .product-price {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--vams-accent);
  }

  .btn-add-to-cart {
    background-color: var(--vams-accent);
    border: none;
    color: #fff;
    font-weight: 500;
  }

  .btn-add-to-cart:hover {
    background-color: #e56724;
  }

  /* Horizontal info cards */
  .info-strip {
    display: flex;
    overflow-x: auto;
    gap: 20px;
    padding: 10px 0;
  }

  .info-card {
    flex: 0 0 auto;
    text-align: center;
    background-color: var(--vams-light);
    padding: .75rem;
    border-radius: .5rem;
    min-width: 110px;
  }

  .info-card i {
    color: var(--vams-dark);
    margin-bottom: .25rem;
  }

  .info-card small {
    display: block;
    font-size: .75rem;
    color: #555;
  }

  .info-card p {
    font-size: .8rem;
    font-weight: 500;
    margin-bottom: 0;
  }

  /* shipping icons list */
  .policy-list i {
    color: var(--vams-dark);
    margin-right: .5rem;
  }

  .policy-list li {
    margin-bottom: .5rem;
  }

  /* Variant cards */
  .variant-badge {
    position: absolute;
    top: 10px;
    right: 10px;
  }
  .preview-btn {
  position: absolute;
  top: 10px;           /* adjust vertical placement */
  right: 10px;         /* adjust horizontal placement */
  font-size: 0.7rem;   /* small text */
  text-transform: uppercase;
  background-color: rgba(128,128,128,0.5); /* semi-transparent grey */
  color: #fff;
  padding: 4px 8px;
  border: none;
  border-radius: 3px;
  backdrop-filter: blur(2px); /* subtle blur behind */
  z-index: 2;
}
.preview-btn:hover {
  background-color: rgba(128,128,128,0.7);
  color:#fff;
}
.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  transition: all .2s ease-in-out;
}


</style>
{% endblock head %}

{% block content %}
<div class="container my-5">
  <div class="row">
    <!-- Left: product image -->
    <div class="col-md-4 text-center">
  <div class="position-relative d-inline-block">
    {% if selected_variant and selected_variant.format == 'ebook' %}
      <button class="btn preview-btn"
        data-bs-toggle="modal" data-bs-target="#pdfModal">
        PREVIEW
      </button>

      <div class="modal fade" id="pdfModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">PDF Preview</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0" style="max-height:100%;overflow-y:auto;">
              {% include "viewer/pdf_viewer_item.html" %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <img src="{{ selected_variant.image.url }}" alt="{{ selected_variant.product.name }}" class="img-fluid rounded">
  </div>
</div>


    <!-- Middle: details -->
    <div class="col-md-5">
      {% if selected_variant.product.category.name == 'Books' %}
      <div class="product-title">
        <h3>{{ selected_variant.product.name }}</h3>
        <div class="product-subline">
          {{ selected_variant.get_format_display }} – {{ selected_variant.product.publication_date }}
        </div>
        <div class="product-author">
          by {{ selected_variant.product.author }} (Author)
        </div>
      </div>
      {% else %}
      <div class="product-title">
        <h3>{{ selected_variant.product.name }}</h3>
      </div>
      {% endif %}

      <p class="text-muted">{{ selected_variant.product.description }}</p>
      <hr>

      {% if selected_variant.product.category.name == 'Books' %}
      <!-- Horizontal scroll info cards -->
      <div class="info-strip">
        <div class="info-card">
          <i class="fa-solid fa-building fa-2x"></i>
          <small>Publisher</small>
          <p>{{ selected_variant.product.publisher }}</p>
        </div>
        <div class="info-card">
          <i class="fa-regular fa-calendar fa-2x"></i>
          <small>Publication date</small>
          <p>{{ selected_variant.product.publication_date }}</p>
        </div>
        <div class="info-card">
          <i class="fa-solid fa-barcode fa-2x"></i>
          <small>ISBN-10</small>
          <p>{{ selected_variant.product.isbn_10 }}</p>
        </div>
        <div class="info-card">
          <i class="fa-solid fa-barcode fa-2x"></i>
          <small>ISBN-13</small>
          <p>{{ selected_variant.product.isbn_13 }}</p>
        </div>
      </div>
      {% elif selected_variant.product.category.name in 'Musical Instruments,Electronics' %}
      <!-- Add other info cards here -->
      {% endif %}

      <!-- Price + Add to Cart -->
      <div class="mt-4">
        <div class="product-price">₹{{ selected_variant.price|floatformat:"0" }}</div>
        <a href="{% url 'add_to_cart' product.category.id %}?variant={{ selected_variant.id }}"
          class="btn btn-add-to-cart mt-2">
          <i class="fa fa-shopping-cart me-1"></i> Add to Cart
        </a>
      </div>

      {% if product.variants.all.count > 1 %}
  <hr class="my-4">
  <h4 class="mb-3">Available Variants</h4>

  <div class="row row-cols-2 g-3">
    {% for variant in product.variants.all %}
      <div class="col">
        <div class="card h-100 border-0 shadow-sm rounded-3 position-relative">
          <!-- badge as ribbon -->
          <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2 rounded-pill px-3 py-1">
            {{ variant.get_format_display|default:variant.sku }}
          </span>

          <div class="card-body d-flex flex-column justify-content-between text-center p-3">
            <h6 class="fw-bold mb-2 text-dark" style="margin-top: 15px;">₹{{ variant.price|floatformat:"0" }}</h6>
            <p class="text-muted small mb-3">Stock: {{ variant.stock }}</p>

            <a href="{% url 'product-detail' product.category.slug product.slug %}?variant={{ variant.id }}"
               class="btn btn-sm px-3 py-1 text-uppercase fw-semibold"
               style="background-color:#FF7A29;color:#fff;border:none;border-radius:50px;">
              View
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

    </div>

    <!-- Right: policies/shipping -->
    <div class="col-md-3">
      <ul class="list-unstyled policy-list">
        <li><i class="fa-solid fa-truck"></i> Delivery: 3-7 Business Days</li>
        <li><i class="fa-solid fa-box-open"></i> Free Shipping: on orders over ₹499</li>
        <li><i class="fa-solid fa-rotate-left"></i> Return Policy: 7-Day Easy Returns</li>
      </ul>
    </div>
  </div>

  {% if relevant_products %}
  <hr class="my-5">
  <h4 class="mb-3">Related Products</h4>
  <div class="d-flex overflow-auto">
    {% for rel in relevant_products %}
    <div class="product-card me-3 position-relative">
      {% if rel.format %}
      <div class="badge">
        {{ rel.get_format_display }}
      </div>
      {% endif %}

      <a href="{% url 'product-detail' rel.product.category.slug rel.product.slug %}?variant={{ rel.id }}">
        <div class="product-tumb">
          <img src="{{ rel.image.url }}" alt="{{ rel.name }}">
        </div>

        <div class="product-details">
          <span class="product-catagory">{{ rel.product.category.name }}</span>

          <h4>
            <a href="{% url 'product-detail' rel.product.category.slug rel.product.slug %}?variant={{ rel.id }}">
              {{ rel.product.name|truncatechars:40 }}
            </a>
          </h4>

          <p class="text-muted small">
            {{ rel.product.description|truncatechars:50 }}
          </p>

          <div class="product-bottom-details">
            <div class="product-price">
              ₹{{ rel.price|floatformat:"0" }}
            </div>
            <div class="product-links">
              <a href="{% url 'add_to_cart' rel.product.category.id %}?variant={{rel.id}}">
                <i class="fa fa-shopping-cart"></i>
              </a>
            </div>
          </div>
        </div>
      </a>
    </div>

    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock content %}